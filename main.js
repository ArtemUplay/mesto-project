(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{Z0:()=>D,kH:()=>N});var t,n,o={baseUrl:"https://nomoreparties.co/v1/plus-cohort-18",headers:{authorization:"0e083d33-4c82-42a0-a1bf-2a5f281af68c","Content-Type":"application/json"}},r=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},c=document.querySelector(".cards__list"),a=document.querySelector("#card-template").content,i=document.querySelector(".image-popup"),u=document.querySelector(".popup_add-card"),s=document.querySelector(".form_add-card"),l=document.querySelector(".form__item_el_name_place"),d=document.querySelector(".form__item_el_photo-link"),f={formSelector:"form",inputSelector:"form__item",submitButtonSelector:"form__button",inactiveButtonClass:"form__button_disabled",inputErrorClass:"form__item_type_error",errorClass:"form__item-error_active"},_=document.querySelector(".profile__edit-avatar"),m=document.querySelector(".popup-avatar"),p=m.querySelector(".popup__close"),v=document.querySelector(".profile__edit-button"),h=document.querySelector(".popup__close_add-card"),y=document.querySelector(".profile__add-button"),S=document.querySelector(".popup__close_image-popup"),q=Array.from(document.querySelectorAll(".popup")),b=document.querySelector(".popup-edit-profile"),E=m.querySelector(".form__item_el_avatar-link"),L=document.querySelector(".profile__avatar-image"),k=b.querySelector(".popup__close"),g=document.querySelector(".profile__name"),C=document.querySelector(".profile__status"),x=document.querySelector(".form__item_el_user-name"),U=document.querySelector(".form__item_el_user-status");function w(e){e.classList.add("popup_opened"),window.addEventListener("keydown",O)}function A(e){e.classList.remove("popup_opened"),window.removeEventListener("keydown",O)}function O(e){q.forEach((function(t){"Escape"===e.code&&t.classList.contains("popup_opened")&&A(t)}))}function P(e,t,n,c,u){var s=a.querySelector(".cards__item").cloneNode(!0),l=s.querySelector(".cards__remove"),d=s.querySelector(".cards__button-like"),f=s.querySelector(".cards__image"),_=document.querySelector(".image-popup__picture"),m=document.querySelector(".image-popup__caption"),p=s.querySelector(".cards__like-count");return s.querySelector(".cards__image").src=t,s.querySelector(".cards__image").alt=e,s.querySelector(".cards__name").textContent=e,n&&n.forEach((function(e){"28ab16d71d783b9e7b01f84f"==e._id&&d.classList.add("cards__button-like_active")})),d.addEventListener("click",(function(e){e.target.classList.contains("cards__button-like_active")?(e.target.classList.remove("cards__button-like_active"),function(e){return fetch("".concat(o.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:o.headers}).then((function(e){return r(e)})).catch((function(e){console.log(e)}))}(u).then((function(e){p.textContent=e.likes.length}))):(e.target.classList.add("cards__button-like_active"),function(e){return fetch("".concat(o.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:o.headers}).then((function(e){return r(e)})).catch((function(e){console.log(e)}))}(u).then((function(e){p.textContent=e.likes.length})))})),p.textContent=n.length,"28ab16d71d783b9e7b01f84f"==c?l.addEventListener("click",(function(e){(function(e){return fetch("".concat(o.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:o.headers}).then((function(e){return r(e)})).catch((function(e){console.log(e)}))})(u).then((function(){e.target.parentNode.remove()}))})):l.classList.add("cards__remove_hidden"),f.addEventListener("click",(function(){w(i),_.src=t,m.textContent=e,_.alt=e})),s}function T(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));o.textContent="",t.classList.remove("".concat(n.inputErrorClass)),o.classList.remove("".concat(n.errorClass))}function j(e,t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?T(e,t,f):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));r.textContent=n,t.classList.add("".concat(o.inputErrorClass)),r.classList.add("".concat(o.errorClass))}(e,t,t.validationMessage,f)}function B(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove("".concat(n.inactiveButtonClass))):(t.disabled=!0,t.classList.add("".concat(n.inactiveButtonClass)))}function D(e){c.prepend(e)}function N(e,t){t.textContent=e?"Сохранение...":"Сохранить"}t=document.querySelector(".form_edit"),n=t.querySelector(".form__button"),t.addEventListener("submit",(function(e){e.preventDefault(),N(!0,n),g.textContent=x.value,C.textContent=U.value,function(e,t){return fetch("".concat(o.baseUrl,"/users/me"),{method:"PATCH",headers:o.headers,body:JSON.stringify({name:e,about:t})}).then((function(e){return r(e)})).catch((function(e){console.log(e)}))}(x.value,U.value).finally((function(){N(!1,n)})),A(b)})),function(){var e=document.querySelector(".form_edit-avatar"),t=e.querySelector(".form__button");e.addEventListener("submit",(function(e){e.preventDefault(),N(!0,t),L.src=E.value,function(e){return fetch("".concat(o.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:o.headers,body:JSON.stringify({avatar:e})}).then((function(e){return r(e)}))}(L.src).finally((function(){N(!1,t)})),A(m)}))}(),function(){var e=s.querySelector(".form__button");s.addEventListener("submit",(function(t){t.preventDefault(),N(!0,e),function(e,t){return fetch("".concat(o.baseUrl,"/cards"),{method:"POST",headers:o.headers,body:JSON.stringify({name:e,link:t})}).then((function(e){return r(e)})).catch((function(e){console.log(e)}))}(l.value,d.value).then((function(e){return D(P(e.name,e.link,e.likes,e.owner._id,e._id))})).finally((function(){N(!1,e)})),s.reset(),A(u)}))}(),fetch("".concat(o.baseUrl,"/cards"),{headers:o.headers}).then((function(e){return r(e)})).catch((function(e){console.log(e)})).then((function(e){!function(e){console.log(e),e.forEach((function(e){D(P(e.name,e.link,e.likes,e.owner._id,e._id))}))}(e.reverse())})),function(e){Array.from(document.querySelectorAll(".".concat(e.formSelector))).forEach((function(t){!function(e,t){var n=Array.from(e.querySelectorAll(".".concat(t.inputSelector))),o=e.querySelector(".".concat(t.submitButtonSelector));B(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){B(n,o,t),j(e,r)}))}))}(t,e)}))}(f),q.forEach((function(e){e.addEventListener("click",(function(t){t.target.classList.contains("popup")&&A(e)}))})),fetch("".concat(o.baseUrl,"/users/me"),{headers:o.headers}).then((function(e){return r(e)})).catch((function(e){console.log(e)})).then((function(e){L.src=e.avatar,g.textContent=e.name,C.textContent=e.about})),_.addEventListener("click",(function(){w(m)})),k.addEventListener("click",(function(){A(b)})),v.addEventListener("click",(function(){w(b);var e=document.querySelector(".form_edit");e.querySelectorAll(".form__item").forEach((function(t){!function(e,t){""==t.value&&T(e,t,f)}(e,t)})),x.value=g.textContent,U.value=C.textContent})),p.addEventListener("click",(function(){A(m)})),y.addEventListener("click",(function(){w(u)})),h.addEventListener("click",(function(){A(u)})),S.addEventListener("click",(function(){A(i)}))})();